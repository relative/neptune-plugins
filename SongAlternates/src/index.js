import{modules as v}from"@neptune";var E=v.find(e=>e.exports?.createElement);if(!E)throw new Error("Couldn't find React module");var l=E.exports;var d=window.__npruSw||(window.__npruSw={wc:{}});var M={key:!0,ref:!0,__self:!0,__source:!0,children:!0},{hasOwnProperty:D}=Object.prototype;function p(e,t,n){let o=null,s=null,a=null,r={};n!==void 0&&(o=""+n),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(s=t.ref),t.children!==void 0&&(a=t.children);for(let i in t)D.call(t,i)&&!M.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps){let i=e.defaultProps;for(let c in i)r[c]===void 0&&(r[c]=i[c])}return l.createElement(e,r,a)}var S=p,V=l.Fragment;var _=d.wc.sym||(d.wc.sym=Symbol("Wrapped Component")),P=d.wc.symName||(d.wc.symName=Symbol("Wrapped Component Name")),u=d.wc.Observers||(d.wc.Observers=new Set),A=(e,t)=>{if(!(m[e]&&!x(m[e]))){m[e]=t;for(let n of u)n(e,t)&&u.delete(n)}},L=e=>{let t=n=>{let[o,s]=l.useState((r=m[e])=>x(r)?void 0:r),a=l.useCallback((r,i)=>r!==e?!1:(s(i),!0),[]);return o?p(o,{...n}):(u.add(a),S("span",{children:["Component ",p("code",{children:e})," has not been captured yet"]}))};return t[_]=!0,t[P]=e,t},x=e=>e[_]===!0,m=new Proxy({},{get(e,t,n){let o=Reflect.get(e,t,n);return o||(typeof t=="string"?e[t]=L(t):o)}});var y=d.wc.Hooks||(d.wc.Hooks=new Map);function I(e){return t=>{let n=p(e,{...t,__ignore:!0});return n._type=n._type||n.type,n.type=function(...o){let s=n._type.apply(this,arguments),a=y.get(e);if(a?.hooks.length)for(let r of a.hooks)r(t,s);return s},n}}function w(e,t){let n=y.get(e)?.hooks??[];if(y.has(e)||y.set(e,{fixed:!1,hooks:n,HookEl:I(e)}),n.push(t),x(e)){let o=y.get(e);if(o&&!o.fixed){let s=e[P];u.add((a,r)=>{if(a!==s)return!1;let i=y.get(e);return i.HookEl=I(r),y.set(r,i).delete(e),!0}),o.fixed=!0}}this.on("unload",()=>{let o=n.indexOf(t);o<0||n.splice(o,1)})}function O(e,t,...n){let o=e.toString();o.includes('"whitespace"===')&&A("ContextMenuAction",e),o.includes("artist")&&o.includes("bodyDemi")&&o.includes("descriptionDemi")&&o.includes("textSecondary")&&o.includes("play-button")&&A("PromptItemCell",e),o.includes("t-go-to-album")&&o.includes("trackList")&&o.includes("playQueue")&&A("ContextMenu",e)}function U(e){l._createElement||(l._createElement=e),l.createElement=function(t,n,...o){if(typeof t=="function"&&!n?.__ignore){O(t,n,...o);let a=y.get(t);a?.HookEl&&(t=a?.HookEl)}return e.call(this,t,n,...o)}}U(l._createElement??l.createElement);var C=new Map;function F(){if(!C.has(this.id))throw new Error("RUPlugin does not exist");C.delete(this.id)}async function R(){let e={id:crypto.randomUUID(),unload:F,hookComponent:w,listeners:new Map,on(t,n){let o=this.listeners.get(t)??new Set;return this.listeners.has(t)||this.listeners.set(t,o),o.add(n),this},async emit(t,...n){let o=this.listeners.get(t);return o?Promise.all([...o].map(s=>s.apply(this,n))):Promise.resolve()},removeListener(t,n){return this.listeners.get(t)?.delete(n),this}};return C.set(e.id,e),e}var H=await R(),h=H;import{actions as k}from"@neptune";var X=()=>{};async function g(e,t,n){return new Promise((o,s)=>{let a=t<=0?X:clearTimeout.bind(null,setTimeout(async()=>{a(),n&&await n(),s(new Error("Timeout exceeded"))},t)),r=async()=>{try{n&&await n()}catch(i){console.warn("Error in asyncClearTimer",i)}};return e(i=>r().then(c=>o(i)),i=>r().then(c=>s(i)))})}import{intercept as N}from"@neptune";function f(e,t){return e.type===t}function b(e,t=5e3,n){let o=new Set;return g((s,a)=>{for(let r of e)o.add(N(r,([i])=>{let c={type:r,payload:i},T=!1;if(typeof n<"u"&&(typeof n=="boolean"?T=n:Array.isArray(n)?T=n.includes(c.type):T=n(c)),s(c),T===!0)return!0}))},t,()=>{o.forEach(s=>s()),o.clear()})}h.hookComponent(m.ContextMenu,(e,t)=>{e.isUserPlaylist&&e.contextMenuLocation==="trackList"&&e.playlistData?.currentPlaylistUuid&&t.props.children[1].props.children.push(p(m.ContextMenuAction,{title:"Replace track",action:async()=>{let n=e.mediaItem?.item?.title+" "+e.mediaItem?.item?.artist?.name;k.modal.showPickTrackModal({promptId:666,userId:666}),k.trackPrompts.setTrackSearchPhrase(n);let o=await b(["trackPrompts/SET_TRACK_FOR_PROMPT","modal/CLOSE"],0,["trackPrompts/SET_TRACK_FOR_PROMPT"]);if(f(o,"trackPrompts/SET_TRACK_FOR_PROMPT")){let s=e.playlistData?.currentPlaylistUuid,a=e.playlistData?.currentOrder??"INDEX",r=e.playlistData?.currentDirection??"ASC",i=e.playlistData?.mediaItemId;k.content.addMediaItemsToPlaylist({playlistUUID:s,onDupes:"ADD",showNotification:!0,addToIndex:e.index,mediaItemIdsToAdd:[parseInt(o.payload.trn.split(":").reverse()[0])]});let c=await b(["content/ADD_MEDIA_ITEMS_TO_PLAYLIST_FAIL","content/ADD_MEDIA_ITEMS_TO_PLAYLIST_SUCCESS"]);f(c,"content/ADD_MEDIA_ITEMS_TO_PLAYLIST_SUCCESS")?k.content.removeMediaItemsFromPlaylist({currentDirection:r,currentOrder:a,mediaItemId:i,playlistUUID:s,removeIndices:[e.index+1],moduleId:null}):f(c,"content/ADD_MEDIA_ITEMS_TO_PLAYLIST_FAIL")}else f(o,"modal/CLOSE")}}))});function Pe(){h.unload()}export{Pe as onUnload};
//# sourceMappingURL=index.js.map
